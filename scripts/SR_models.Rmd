---
title: "Haddock S-R models"
author: "David Keith"
date: "11/14/2021"
output:
  bookdown::word_document2: default
  #bookdown::pdf_document2: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen = 999)
library(tidyverse)
library(cowplot)
library(lme4)
library(arm)
theme_set(theme_bw(base_size = 14))
# Load in the data.
dat <- readxl::read_xlsx("D:/Github/Haddock/Data/Stock_recruit_long_all.xlsx",sheet = "data")

# Temp fix while xls is out of commision
names(dat) <- c("year","recruits","ssb","stock","region","Species","location","Assessment","remove","order","comment")
# Get the Rec/SSB value
dat$rec.ssb <- dat$recruits/dat$ssb
dat$log.r.ssb <- log(dat$rec.ssb)
# Get the maximum SSB for each stock, tidyverse mutate is so smart here...
dat <- dat %>% dplyr::group_by(stock) %>% dplyr::mutate (max.ssb= max(ssb))
dat$ssb.prop <- dat$ssb/dat$max.ssb
dat <- as.data.frame(dat)
dat <- dat %>% dplyr::group_by(stock) %>% dplyr::mutate(rssb.stan = as.numeric(scale(rec.ssb)),
                                                        log.rssb.stan = as.numeric(scale(log.r.ssb)))
dat$l.rec <- log10(dat$recruits)
dat$Period <- "Pre 1993"
dat$Period[dat$year >= 1993] <- "Recent"
dat$Period <- as.factor(dat$Period)
cols <- c("firebrick1","darkblue")
lty <- c("solid","dashed")
dat$alpha <- NA
dat$alpha.sd <- NA
dat$resids <- NA

# Now I need to get the recruits to all be 1 year olds....
# The NS Haddock is Age 0, so multiply by 0.2
m <- 0.2
dat$recruits[dat$stock == "Haddock North Sea"] <- (1-m) * dat$recruits[dat$stock == "Haddock North Sea"]
# Irish Cod is Age 0so we need to step it back two years to get to 1 year olds
dat$recruits[dat$stock == "Haddock Irish Sea"] <- (1-m) * dat$recruits[dat$stock == "Haddock Irish Sea"]

# Icelandic Cod is Age 3 so we need to step it back two years to get to 1 year olds
dat$recruits[dat$stock == "Cod Icelandic"] <- dat$recruits[dat$stock == "Cod Icelandic"] / ((1-m)*(1-m)) 
# Icelandic Haddock is Age 2, so just one year back
dat$recruits[dat$stock == "Haddock Icelandic"] <- dat$recruits[dat$stock == "Haddock Icelandic"] / (1-m) 
# Barents Sea Haddock is Age 3, so two steps back
dat$recruits[dat$stock == "Haddock Barents Sea"] <- dat$recruits[dat$stock == "Haddock Barents Sea"] / ((1-m)*(1-m)) 
# Barents Sea Cod is also Age 3, so two steps back
dat$recruits[dat$stock == "Cod Barents Sea"] <- dat$recruits[dat$stock == "Cod Barents Sea"] / ((1-m)*(1-m)) 

# All other NE Atlantic stocks and all of the NW Atlantic stocks are Age 1 recruits


# Lets just stick with the most recently assessed.  
dat <- dat %>% dplyr::filter(Assessment == 'Current')
# And we'll toss the W of Scotland and the combo WoS + NS stocks as there is no Haddock stock to match.
dat <- dat %>% dplyr::filter(!stock %in% c("Cod North Sea + W. of Scot.","Cod West of Scotland"))

dat$stock <- factor(dat$stock,levels = c("Haddock Icelandic","Cod Icelandic","Haddock  Faroese","Cod Faroese","Haddock Barents Sea","Cod Barents Sea" ,
                                         "Haddock Irish Sea","Cod Irish Sea","Haddock North Sea","Cod North Sea",
                                         "Haddock Eastern Scotian Shelf","Cod Eastern Scotian Shelf","Haddock Western Scotian Shelf","Cod Western Scotian Shelf",
                                         "Haddock Eastern Georges Bank" , "Cod Eastern Georges Bank"))

dat$location[dat$location=="Icelandic"] <- "Iceland"

dat$location <- factor(dat$location,levels = c("Iceland","Faroese","Barents Sea",
                                               "Irish Sea","North Sea",
                                               "Eastern Georges Bank", "Western Scotian Shelf","Eastern Scotian Shelf"))

# Removing that crazy Haddock point in 2013 for WSS Haddock does nothing to the fit, which is bizarre, but it matches expecations from the rest of the data somehow?
#dat <- dat[!(dat$stock == "Haddock Western Scotian Shelf" & dat$year == 2013),]




```

## Fogarty re-analysis

This analysis will compare recruitment between the primary harvested sympatric Atlantic Cod and Haddock stocks in the Atlantic Ocean, comparing the period before 1993 (*Pre-1993 Period*) with the period from 1993 onwards (*Recent Period*), data shown in Figure \@ref(fig:fog-rec).

```{r fog-rec, message=F,echo =F,fig.width=11,fig.height=11,fig.cap= "Recruitment (in millons) time series for 8 Atlantic Cod (solid line) and Haddock (dashed line) stocks in the Atlantic Ocean.  The red line indicates data from the Pre-1993 Period, while the blue line is for the Recent Period. The vertical grey line indicates the division between the two periods"}
# Recruits vs SSB
p0 <- ggplot(dat %>% dplyr::filter(region == "Northeast Atlantic")) + geom_line(aes(y=recruits/1000, x= year,colour = Period,linetype = Species)) + 
              facet_wrap(~location ,scales = 'free',ncol=3) + xlab("") + ylab("Recruits (Number in Millons)")  + 
              scale_color_manual(values = cols)  + scale_linetype_manual(values = lty) + scale_y_log10() + 
              scale_x_continuous(limits = c(1945,2020),breaks = seq(1950,2020,by=10)) +
              geom_vline(xintercept = 1992.5,color = "grey",size =2) + 
              theme(axis.title.y = element_text(hjust=0),
                    legend.position = c(0.85, 0.25), 
                    legend.title.align=1,
                    legend.text.align = 1,
                    legend.title = element_text(size=16),
                    legend.text = element_text(size=12),
                    legend.key.width = unit(3,"cm")) + guides(colour = guide_legend(override.aes = list(size=1.5),title.position = "top"),
                                                              linetype = guide_legend(override.aes = list(size=1.5)))

# Now the NW Atlantic stocks
p1 <- ggplot(dat %>% dplyr::filter(region == "Northwest Atlantic")) + geom_line(aes(y=recruits/1000, x= year,colour = Period,linetype = Species)) + 
              facet_wrap(~ location ,scales = 'free',ncol=3) + xlab("Year") + ylab("")  + 
              scale_color_manual(values = cols)  + scale_linetype_manual(values = lty) + scale_y_log10() + 
              scale_x_continuous(limits = c(1945,2020),breaks = seq(1950,2020,by=10)) +
              geom_vline(xintercept = 1992.5, color ='grey',size=3)+
              theme(legend.position = "none")

p.rec.ts <- plot_grid(p0,p1,nrow=2,rel_heights = c(2,1))
p.rec.ts
```

Next up was a simple stock-recruitment model using the linearization of the Ricker SR model.

$$ log\left(\frac{Rec}{SSB}\right) = log(a) - b\times SSB + \epsilon_i$$

This analysis will be used to quantify differences between the stocks, species, and the periods by looking at the variability of the residuals for each stock and the slope at the origin. So to do this we need to fit the above Ricker model.  


So here I think we can start to see the problem of having different age classes included for the recruitment time series Figure \@ref(fig:rssb-ssb-plot)). If, for example, all the Atlantic Cod stocks used Age 3 recruits and all the Haddock stocks used Age 1 recruits, the alpha from our stock assessment models could simply be lower for Cod than it is for Haddock because the Cod are 2 years older and a bunch of the recruits died.  As such we need to come up with a method to 'standardize' the recruit time series.  One option is to do what Fogarty did and standardize to Age 1, which means we need to come up with some 'survival rate' for any stock that isn't currently using Age 1 recruits.  I believe most stocks are Age 1, but will need to go back into the data and check on that.  The other option would be to use 3 year olds (I don't think there are any stocks in which recruits are more than 3 years old), nice bit about that is we would be using the data, main problem I can see is that we'd need to make sure that F is really really low for this age group for all the stocks, and I doubt that is the case.

```{r rssb-ssb-setup, echo =F,include =F,message=F}

# Now the Rec/SSB vs SSB figure, with a line of best fit, not ugly at all....
p0 <- ggplot(dat %>% dplyr::filter(region == "Northeast Atlantic"),aes(y=rec.ssb, x= ssb,colour = Period,shape = Species,linetype = Species)) + geom_point() + 
              facet_wrap(~location ,scales = 'free_x',ncol=3) + xlab("") + ylab("Recruits/SSB")  + 
              scale_color_manual(values = cols)  + scale_linetype_manual(values = lty) + scale_y_log10() + 
              geom_smooth(method = 'lm') + scale_x_continuous(limits = c(0,NA)) +
#              scale_x_continuous(limits = c(1945,2020),breaks = seq(1950,2020,by=10)) +
#              geom_vline(xintercept = 1992.5,color = "grey",size =2) + 
              theme(axis.title.y = element_text(hjust=0),
                    legend.position = c(0.85, 0.25), 
                    legend.title.align=1,
                    legend.text.align = 1,
                    legend.title = element_text(size=16),
                    legend.text = element_text(size=12),
                    #legend.key.size = unit(3,"line"),
                    legend.key.width = unit(3,"cm")) + guides(#shape = guide_legend(override.aes = list(size=0),title.position = "top"),
                                                              linetype = guide_legend(override.aes = list(size=1,color='black'))
                                                              )
# Now do this to make the symbol larger than the line thickness in the legend, wild!
p0
# This does something funky
grid::grid.ls(grid::grid.force())

# Set the size of the point in the legend to 2 mm
grid::grid.gedit("key-[-0-9]-1-1", size = unit(4, "mm"))

# save the modified plot to an object
p.tidy <- grid::grid.grab()

# Now the NW Atlantic stocks
p1 <- ggplot(dat %>% dplyr::filter(region == "Northwest Atlantic"),aes(y=rec.ssb, x= ssb,colour = Period,shape = Species,linetype = Species)) + geom_point() + 
              facet_wrap(~ location ,scales = 'free',ncol=3) + xlab("SSB (tonnes)") + ylab("")  + 
              scale_color_manual(values = cols)  + scale_linetype_manual(values = lty) + scale_y_log10() + 
              geom_smooth(method = 'lm') + scale_x_continuous(limits = c(0,NA)) +
#              scale_x_continuous(limits = c(1945,2020),breaks = seq(1950,2020,by=10)) +
#              geom_vline(xintercept = 1992.5, color ='grey',size=3)+
              theme(legend.position = "none")
# And combo them
p.rec.per.ssb <- plot_grid(p.tidy,p1,nrow=2,rel_heights = c(2,1))
```

```{r rssb-ssb-plot, echo =F,fig.width=11,fig.height=11,message=F,fig.cap = "Recruits/SSB (log scale) vs SSB, Linear model fit on log(10) scale"}
p.rec.per.ssb
```



```{r mods, echo =F,include =F}
# The cod model
#summary(mod.stan)
#plot(mod.stan)
#ranef(mod.stan)
#se.ranef(mod.stan)
# Split the data into the 2 time series
dat.pre <- dat %>% dplyr::filter(Period == 'Pre 1993')
dat.recent <- dat %>% dplyr::filter(Period == 'Recent')
# Get the stocks ready for the loop
stocks <- unique(dat$stock)
n.stocks <- length(stocks)
# And run the S-R model for each stock/era individually.

for(i in 1:n.stocks)
{
  # Filter the data into the pre and recent periods
  pre.d <- dat.pre %>% filter(stock == stocks[i])
  recent.d <-        dat.recent %>% filter(stock == stocks[i])
  # Now run the models, but only run if you have data (i.e. Irish pre Cod has not data)
  if(nrow(pre.d) > 0) mod.pre <-   lm(log.r.ssb ~ ssb, data= pre.d)
  mod.recent <-      lm(log.r.ssb ~ ssb, data= recent.d)
  # Now stick the data back into the data frames, first the alphas and their Standard Deviation from the model
  if(nrow(pre.d) > 0) dat.pre$alpha[dat.pre$stock == stocks[i]] <- coefficients(mod.pre)[1]
  if(nrow(pre.d) > 0) dat.pre$alpha.sd[dat.pre$stock == stocks[i]] <- summary(mod.pre)$coefficients[1,2]
  dat.recent$alpha[dat.recent$stock == stocks[i]] <- coefficients(mod.recent)[1]
  dat.recent$alpha.sd[dat.recent$stock == stocks[i]] <- summary(mod.recent)$coefficients[1,2]
  # Now the residuals
  if(nrow(pre.d) > 0) dat.pre$resids[dat.pre$stock == stocks[i]] <- residuals(mod.pre)
  dat.recent$resids[dat.recent$stock == stocks[i]] <-    residuals(mod.recent)
}

#ggplot(dat %>% dplyr::filter(stock == "Haddock Western Scotian Shelf"),aes(x=ssb,y = rec.ssb,colour = Period)) + geom_point() + scale_y_log10() + geom_smooth(method='lm') 
sum <- dat.mod %>% dplyr::group_by(stock,Period) %>% dplyr::summarise(log_alpha = mean(alpha,na.rm=T))
View(sum)

#write.csv(sum,"D:/Github/Haddock/Data/slope_at_orgins.csv")

# So North Sea Haddock and Western SS Haddock are both wild... Let's look closer at them...
dat.mod <- bind_rows(dat.pre,dat.recent)
dat.mod$alpha.exp <- exp(dat.mod$alpha)
dat.mod$LCI <- dat.mod$alpha - 1.96 *dat.mod$alpha.sd
dat.mod$UCI <- dat.mod$alpha + 1.96 *dat.mod$alpha.sd


```

```{r sr-resid-plot,fig.width=11,fig.height=11,message=F,fig.cap = "Residuals from the Ricker Stock recruitment model."}

p <- ggplot(dat.mod %>% dplyr::filter(region == "Northeast Atlantic"),aes(y=resids, x= year,colour = Period,linetype = Species)) +    
              geom_line() + 
              facet_wrap(~location ,ncol=3) + xlab("") + ylab("Residuals")  + 
              scale_color_manual(values = cols)  + 
              geom_hline(yintercept = 0, color='grey',linetype = 'dashed')+
              scale_x_continuous(limits = c(1945,2020),breaks = seq(1950,2020,by=10),labels = NULL) +
              theme(axis.title.y = element_text(hjust=0.25),
                    legend.position = c(0.85, 0.25), 
                    legend.title.align=1,
                    legend.text.align = 1,
                    legend.title = element_text(size=16),
                    legend.text = element_text(size=12),
                    #legend.key.size = unit(3,"line"),
                    legend.key.width = unit(3,"cm")) 

p1 <- ggplot(dat.mod %>% dplyr::filter(region=="Northwest Atlantic"),aes(y=resids, x= year,colour = Period,linetype = Species)) +
              geom_line() + geom_hline(yintercept = 0, color='grey',linetype = 'dashed')+
              scale_x_continuous(limits = c(1945,2020),breaks = seq(1950,2020,by=10)) +
              facet_wrap(~location ,ncol=3) + xlab("Year") + ylab("")  + 
              scale_color_manual(values = cols) + theme(legend.position = "none")

sr.resid.plt <- plot_grid(p,p1,nrow=2,rel_heights = c(2,1))
sr.resid.plt
```

```{r sr-alpha-plot}

# This is super ugly....
dat.cur <- NULL;dat.past <- NULL
for(i in 1:n.stocks) dat.cur[[stocks[i]]] <- dat.mod[dat.mod$Period == "Recent" & dat.mod$stock  == stocks[i],][1,]
for(i in 1:n.stocks) dat.past[[stocks[i]]] <- dat.mod[dat.mod$Period == "Pre 1993" & dat.mod$stock  == stocks[i],][1,]

dat.cur <- do.call('rbind',dat.cur)
dat.past <- do.call('rbind',dat.past)
dat.alpha <- rbind(dat.cur,dat.past)
d.alp <- dat.alpha %>% dplyr::select(Species,location,alpha,LCI,UCI,stock,Period)
d.alp <- d.alp[!is.na(d.alp$Species),]
d.had <- d.alp[d.alp$Species == "Haddock",]
#d.had <- d.had[!is.na(d.had$Species),]

d.cod <- d.alp[d.alp$Species == "Cod",]
#d.cod <- d.cod[!is.na(d.cod$Species),]
d.cod <- d.cod[!(d.cod$location == "Irish Sea" & d.cod$Period == "Pre 1993"),]

names(d.had) <- c("Species","location","alpha.had","LCI.had","UCI.had",'stock','Period')
names(d.cod) <- c("Species","location","alpha.cod","LCI.cod","UCI.cod",'stock',"Period")
d.merge <- data.frame(location = d.had$location, 
                      Period = d.had$Period,
                      alpha.had = d.had$alpha.had,
                      LCI.had = d.had$LCI.had,
                      UCI.had = d.had$UCI.had,
                      alpha.cod = d.cod$alpha.cod,
                      LCI.cod = d.cod$LCI.cod,
                      UCI.co = d.cod$UCI.cod)

# SO this is the wrong figure, cause I want to make this plot using the SD of the residuals from the SR.  
# But maybe I want to make a plot using these somehow....
p <- ggplot(d.merge) + geom_point(aes(y = alpha.had,x=alpha.cod,colour= location)) + facet_wrap(~Period) +
     
     scale_y_continuous(limits=c(-2,5)) + scale_x_continuous(limits=c(-2,5)) +geom_abline(slope=1,intercept = 0)
p



```



First we look at the residuals from the Stock Recruitment relationship (Figure \@ref(fig:ricker-resids)).  















```{r ricker-resids, message=F,echo =F,fig.width=11,fig.height=11,fig.cap= "Recruits vs SSB for the world largest Haddock stock and some other less important things."}
# Recruits vs SSB

p1 <- ggplot(dat %>% dplyr::filter(region == "Northeast Atlantic")) + geom_text(aes(y=recruits, x= ssb,colour = Period,label=substr(year,3,4)),size=2) + facet_wrap(~  stock ,scales = 'free',ncol=3) + xlab("SSB") + ylab("Recruits")  + scale_color_manual(values = cols) 
# Now the NW Atlantic stocks
p2 <-  ggplot(dat %>% dplyr::filter(region == "Northwest Atlantic")) + geom_text(aes(y=recruits, x= ssb,colour = Period,label=substr(year,3,4)),size=2) + facet_wrap(~  stock ,scales = 'free',ncol=3) + xlab("SSB") + ylab("Recruits")  + scale_color_manual(values = cols) 
# Now combine ito p_awesome
p.ricker.resid <- plot_grid(p1,p2,nrow=2,rel_heights = c(2,1))
p.ricker.resid
```


From this, I think the linear relationship holds pretty well at lower SSB for these stocks, but for Cod we have really no evidence of an S-R relationship for half the stocks.  So, I did something I like doing and split the data up, this time I split it at 0.4 of maximum SSB and fit linear models for each half of the data to see if anything interesting popped  (Figure \@ref(fig:rssb-ssb-lt40)), obviously some of these look a bit silly. But that triggered me to think of a piecewise regression model for the data, which did more what I was hoping for (Figure \@ref(fig:rssb-ssb-pw)). It's an interesting mix of responses, I think all the 'breakpoints' are < 50% of max SSB, but that could be an artifact of having most of the data at < 50% of maximum SSB, or maybe it is something biologically interesting?  The RAM idea of higher variability in recruitment near edge of their range might be in here if I squint really hard, maybe?



```{r rssb-ssb-pw, echo =F,fig.width=11,fig.height=11,message=F,fig.cap= "Recruits/SSB (log scale) vs SSB with SSB as a proportion of maximum SSB.  Piecewise regression with the breakpoint based on the data, only 1 knot allowed and forcing a linear fit for each piece."}

# The Rec/SSB using the only > 20% data...

p4 <- ggplot(dat,aes(y=rec.ssb, x= ssb.prop)) +   
                geom_text(aes(label=substr(year,3,4)),size=2) + #geom_smooth(method='lm') +
                geom_smooth(method = "gam", formula = y ~ splines::bs(x, df = 2, degree = 1)) +
                scale_y_log10() + scale_x_continuous(limits = c(0,1)) +
                facet_wrap(~region+species + stock ,scales = 'free') + xlab("SSB") + ylab("Rec/SSB") 

p4

```

So now we can formally model the stock-recruit relationship, for the moment it's just a standard Ricker model formulation but all stocks included in one shot. I think what my main takeaway is that variance issue, the residuals for the haddock stocks generally seem to be larger than observed for the cod stocks (Figure \@ref(fig:mod-plot)). A quick hacky estimate of the size of residuals suggests that the Haddock variance is higher, with the residuals being almost twice as large for Haddock, and it is pretty remarkably consistent on each side of the pond.

```{r mods, echo =T}
# The cod model
#mod.stan <- lmer(log.rssb.stan ~ ssb.prop + (1+ssb.prop|stock) ,data= dat)
#summary(mod.stan)
#plot(mod.stan)
#ranef(mod.stan)
#se.ranef(mod.stan)
dat.fog <- dat %>% dplyr::filter(era == "Fogarty", era == 'Fogarty')
dat.edda <- dat %>% dplyr::filter(era == "Edda", era == 'Edda')
# Think I'm gonna do this the shitty way and just do these stock by stock rather than in one tidy model.
mod.fog <- lmer(log.r.ssb ~ ssb.prop + (1+ssb.prop|stock) ,data= dat.fog)
mod.edda <- lmer(log.r.ssb ~ ssb.prop + (1+ssb.prop|stock) ,data= dat.edda)
#summary(mod.edda)
#plot(mod.edda)
#ranef(mod.edda)
# So the intercept and slope for the Edda era are entirely confounded, hmm... plot(ranef(mod.edda)$stock[,1],ranef(mod.edda)$stock[,2])
#se.ranef(mod.log)

#dat$res.stan <- residuals(mod.stan)
dat.fog$res.fog <- residuals(mod.fog)
size.resid <- dat.fog %>% dplyr::group_by(region,species) %>% dplyr::summarise(abs.res =mean(abs(res.fog)))

# Here is the mean absolute size of the residuals from the model broken out by species and Region.  
print(size.resid)

```

```{r mod-plot, echo =F,fig.width=11,fig.height=11,fig.cap = 'Residuals vs SSB (Proportion) from the stock-recruit model using log(Rec/SSB) ~ SSB'}


# Now combine the residuals and plot them up.
# This is the Standarided data
# p5 <- ggplot(dat,aes(y=res.stan, x= ssb.prop)) + geom_text(aes(label=substr(year,3,4)),size=2) +
#       facet_wrap(~region+species + stock,scales = 'free') + xlab("SSB") + ylab("Resids")  + geom_hline(yintercept = 0,linetype=2,color='grey')
# p5
# This is the log transformed data
p6 <- ggplot(dat,aes(y=res.log, x= ssb.prop)) + geom_text(aes(label=substr(year,3,4)),size=2) +
      facet_wrap(~region+species + stock,scales = 'free_x') + xlab("SSB") + ylab("Resids")  + geom_hline(yintercept = 0,linetype=2,color='grey')
p6

```


```{r lowess, echo=F,include=F,message=F}

# Log transform the data
dat$log.rec <- log10(dat$recruits)

# Fit a loess by stock, we could fit by stock and era, but I think it makes more sense to fit the whole time series and go from there.
# 
dat <- dat %>% dplyr::group_by(stock) %>% dplyr::mutate(low = predict(loess(log.rec ~ year, span = 40/length(log.rec))))
# Get the loess residuals
dat <- dat %>% dplyr::mutate(resid = log.rec-low)
# Then get the sd of those residuals
dat <- dat %>%  dplyr::group_by(stock) %>% dplyr::mutate(sd = sqrt(resid^2/(length(resid)-1)))
# Now lets see how the residuals look between the species/areas
sds <- dat %>% dplyr::group_by(era,stock) %>% dplyr::summarise(mn = mean(sd))
sds

# Plot the loess smooths
p <- ggplot(dat) + geom_point(aes(x=year, y = log.rec,color=era)) + geom_line(aes(x=year,y=low,color=era)) + facet_wrap(~stock)
# plot the residuals
p <- ggplot(dat) + geom_point(aes(x=year, y = resid,color=era)) +  facet_wrap(~stock)
p



```

So having done this, most of what I was thinking about when looking at the Barents Sea stocks is probably off to the bin.  The two obvious bits I think this could inform

1:  Higher variability in recruitment for Haddock.  I'm not sure if the S-R methods are necessary to pull this info out.

2:  Might RAM's recruitment variability along edges be tested here, I think that may be worth exploring more.

Let's check to see if the results of the S-R models are the same as what Fogarety made.  Fogarety made point that cod produce more rec/ssb at low abundance, so check data back to his years and see if we get same. Let's do a 2 period thing and see what difference is.  Perhaps break point being where Fogarety break point is.
Look at autocorrelation in the residual time series, we getting runs of good/bad years?